

#standardsql
SELECT
  airport,
  (FORMAT("%f,%f",latitude,longitude)) AS location,
  FORMAT_TIMESTAMP('%Y%m%d-%H%M%S', timestamp) AS timestamp,
  dep_delay,
  arr_delay,
  num_flights
FROM
  `cloud-training-demos.flights.streaming_delays`
WHERE
  airport = 'DEN'
ORDER BY
  timestamp DESC





#standardsql
SELECT
  airport,
  arr_delay,
  dep_delay,
  timestamp,
  latitude,
  longitude,
  num_flights
FROM
  `cloud-training-demos.flights.streaming_delays` t1
INNER JOIN (
  SELECT
    MAX(timestamp) latest
  FROM
    `cloud-training-demos.flights.streaming_delays` ) t2
ON
  ABS(TIMESTAMP_DIFF(t1.timestamp, t2.latest, MINUTE)) < 29
WHERE
  num_flights > 3
